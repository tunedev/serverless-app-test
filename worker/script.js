!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t){var r=(e={})=>new Proxy(e,{get:(e,t,r)=>"handle"===t?async(t,...r)=>{for(let[n,o]of e.r.filter(e=>e[2]===t.method||"ALL"===e[2])){let e,s,a;if(e=(a=new URL(t.url)).pathname.match(n)){t.params=e.groups,t.query=t.query||Object.fromEntries(a.searchParams.entries());for(let e of o)if(void 0!==(s=await e(t.proxy||t,...r)))return s}}}:(n,...o)=>(e.r=e.r||[]).push([`^${((e.base||"")+n).replace(/(\/?)\*/g,"($1.*)?").replace(/\/$/,"").replace(/:(\w+|\()(\?)?(\.)?/g,"$2(?<$1>[^/$3]+)$2$3").replace(/\.(?=[\w(])/,"\\.")}/*$`,o,t.toUpperCase()])&&r});class n extends Error{constructor(e){super(e),Object.setPrototypeOf(this,n.prototype)}}class o extends n{constructor(e){super("Resource not found"),this.reason=e,this.statusCode=404,Object.setPrototypeOf(this,o.prototype)}serializeErrors(){return[{message:this.reason||"Not Found"}]}}class s extends n{constructor(e){super(e),this.reason=e,this.statusCode=422,Object.setPrototypeOf(this,s.prototype)}serializeErrors(){return[{message:this.reason}]}}const a=e=>e instanceof n?new Response(JSON.stringify({errors:e.serializeErrors()}),{status:e.statusCode}):(console.log("Error occured",e.message),new Response(JSON.stringify({errors:[{message:"something broke"}]}),{status:500}));class i{constructor(e){this.location=e}async getWeather(){const e=await fetch(this.getWeatherURL()),t=await e.json();return this.formatResponse(t)}}const l=e=>9*e/5+32,c=(e,t)=>{const r=new Date(1e3*e);return r.setMinutes(r.getMinutes()+t),r.toISOString()};var u=Object.freeze({__proto__:null,WeatherAPI:class extends i{getWeatherURL(){if(!WEATHER_API_KEY)throw new Error("WEATHER_API_KEY needs to be set in the environment");return`http://api.weatherapi.com/v1/current.json?key=${WEATHER_API_KEY}&q=${this.location.lat},${this.location.lon}`}formatResponse(e){if(console.log(JSON.stringify(e)),!e)throw new Error("WeatherAPI response is not valid");const{location:t,current:r}=e;if(!t||!r)throw new Error("WeatherAPI response is not valid");return{location_name:t.name,location_lat:t.lat,location_lon:t.lon,location_country:t.country,temperature_c:r.temp_c,temperature_f:r.temp_f,temperature_feelslike_c:r.feelslike_c,temperature_feelslike_f:r.feelslike_f,wind_kph:r.wind_kph,wind_degree:r.wind_degree,pressure:r.pressure_mb,humidity:r.humidity,clouds:r.cloud,updated_at:r.last_updated}}},OpenWeatherMap:class extends i{getWeatherURL(){if(!OPEN_WEATHER_MAP_API_KEY)throw new Error("OPEN_WEATHER_MAP_API_KEY needs to be set in the environment");return`https://api.openweathermap.org/data/2.5/weather?units=metric&lat=${this.location.lat}&lon=${this.location.lon}&appid=${OPEN_WEATHER_MAP_API_KEY}`}formatResponse(e){if(!e)throw new Error("OpenWeatherMap response is not valid");const{coord:t,main:r,wind:n,name:o,clouds:s,sys:a,timezone:i,dt:u}=e;return{location_name:o,location_lat:t.lat,location_lon:t.lon,location_country:a.country,temperature_c:r.temp,temperature_f:l(r.temp),temperature_feelslike_c:r.feels_like,temperature_feelslike_f:l(r.feels_like),wind_kph:n.speed,wind_degree:n.deg,pressure:r.pressure,humidity:r.humidity,clouds:s.all,updated_at:c(u,i)}}}});const p=r();p.get("/",()=>new Response('\n        <!DOCTYPE html>\n          <html>\n            <head>\n              <style>\n                a.link{\n                        display: block;\n                        font-size: 16px;\n                        text-decoration: none;\n                        background-color: black;\n                        padding: 15px 32px;\n                        border-radius: 3px;\n                        color: white;\n                        border: none;\n                        max-width: 100px;\n                        text-align: center;\n                        text-transform: uppercase;\n                      }\n                a.link:hover{\n                  opacity: 0.8;\n                  transition: all 0.07s ease-in;\n                }\n              </style>\n            </head>\n            <body>\n\n              <div>\n                <h1>Hello, Thanks for checking me out</h1>\n                <br/>\n                <a title="to see the sample" class="link" href="current_weather?lat=49.2&lon=16.61">\n                  click here\n                </a>\n              </div>\n            </body>\n          </html>\n        ',{status:200,headers:new Headers({"Content-Type":"text/html"})})).get("/current_weather",async e=>{if(e.query){const{lon:t,lat:r,source:n="WeatherAPI"}=e.query;if(isNaN(parseFloat(t))||isNaN(parseFloat(r)))throw new s("Invalid coordinates, ensure lon and lat values are numbers");if(!Object.keys(u).find(e=>e.toLowerCase()===n.toLowerCase()))throw new s(`Invalid source, ensure it is among this values (${Object.keys(u).join(", ")})`);const o={lon:parseFloat(t),lat:parseFloat(r)},a=await new u[n](o).getWeather();return new Response(JSON.stringify(a),{status:404})}throw new s("Must pass a lattitude and a longitude as lon and lat in the query params")}).all("*",()=>{throw new o});addEventListener("fetch",(function(e){var t;e.respondWith((t=e.request,p.handle(t).catch(a)))}))}]);